<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8" />
    <title>æˆ‘çš„å·¥æ™‚ç´€éŒ„</title>
    <style>
        table,
        th,
        td {
            border: 1px solid black;
            border-collapse: collapse;
            padding: 8px;
        }
    </style>
</head>

<body>
    <div id="userInfo" style="text-align: right; margin: 10px;"></div>
    <h2>ğŸ‘€ æˆ‘çš„å·¥æ™‚ç´€éŒ„</h2>

    <table id="logTable">
        <thead>
            <tr>
                <th>æ—¥æœŸ</th>
                <th>é–‹å§‹æ™‚é–“</th>
                <th>çµæŸæ™‚é–“</th>
                <th>é¡å‹</th>
                <th>å…§å®¹</th>
                <th>åŠ ç­</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        const username = localStorage.getItem("username");
        const token = localStorage.getItem("token");
        if (!username || !token) {
            alert("è«‹å…ˆç™»å…¥");
            window.location.href = "/login.html";
        } else {
            document.getElementById("userInfo").innerText = `ğŸ‘¤ ä½¿ç”¨è€…ï¼š${username}`;
        }

        async function loadWorkLogs() {
            try {
                const res = await fetch("/api/workLogs/mine", {
                    headers: {
                        Authorization: "Bearer " + token
                    }
                });

                const data = await res.json();
                if (res.ok) {
                    const tbody = document.querySelector("#logTable tbody");
                    tbody.innerHTML = "";

                    data.forEach(log => {
                        const tr = document.createElement("tr");

                        const start = new Date(log.StartTime).toLocaleTimeString("zh-TW", {
                            hour: "2-digit",
                            minute: "2-digit",
                            hour12: false
                        });

                        const end = new Date(log.EndTime).toLocaleTimeString("zh-TW", {
                            hour: "2-digit",
                            minute: "2-digit",
                            hour12: false
                        });

                        tr.innerHTML = `
                        <td>${log.WorkDate.slice(0, 10)}</td>
                        <td>${start}</td>
                        <td>${end}</td>
                        <td>${log.WorkType}</td>
                        <td>${log.Description}</td>
                        <td>${log.IsOvertime ? "âœ…" : ""}</td>
                    `;
                        tbody.appendChild(tr);
                    });
                } else {
                    alert("âŒ æŸ¥è©¢å¤±æ•—ï¼š" + data.message);
                }
            } catch (err) {
                alert("âŒ ç„¡æ³•è¼‰å…¥è³‡æ–™");
                console.error(err);
            }
        }

        loadWorkLogs();
    </script>
</body>

</html>